(function ($) {
  ((g) => {
    var h,
      a,
      k,
      p = "The Google Maps JavaScript API",
      c = "google",
      l = "importLibrary",
      q = "__ib__",
      m = document,
      b = window;
    b = b[c] || (b[c] = {});
    var d = b.maps || (b.maps = {}),
      r = new Set(),
      e = new URLSearchParams(),
      u = () =>
        h ||
        (h = new Promise(async (f, n) => {
          await (a = m.createElement("script"));
          e.set("libraries", [...r] + "");
          for (k in g)
            e.set(
              k.replace(/[A-Z]/g, (t) => "_" + t[0].toLowerCase()),
              g[k]
            );
          e.set("callback", c + ".maps." + q);
          a.src = `https://maps.${c}apis.com/maps/api/js?` + e;
          d[q] = f;
          a.onerror = () => (h = n(Error(p + " could not load.")));
          a.nonce = m.querySelector("script[nonce]")?.nonce || "";
          m.head.append(a);
        }));
    d[l] ? console.warn(p + " only loads once. Ignoring:", g) : (d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)));
  })({
    key: "AIzaSyDeu5PLiROT93YdisUqYbAGVjyPxZKn8RY",
    v: "weekly",
  });

  $(function () {
    if ($("#googlemap").length) {
      let map;
      let options = {
        center: { lat: 54.06051066099781, lng: 23.49315597208257 },
        zoom: 3.7,
        mapId: "263471ae1c206f534acb7728",
        disableDefaultUI: true,
        zoomControl: false,
      };

      const markers = [
        {
          position: { lat: 57.70946660936181, lng: 11.972878540844464 },
          title: "Gothenburg, Sweden",
        },
        {
          position: { lat: 55.673960023623664, lng: 12.563035554263275 },
          title: "Copenhagen, Denmark",
        },
        {
          position: { lat: 48.18533748791591, lng: 16.376565111690617 },
          title: "Vienna, Austria",
        },
      ];

      async function initMap() {
        const { Map } = await google.maps.importLibrary("maps");
        const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
        const parser = new DOMParser();

        map = new Map(document.getElementById("googlemap"), options);

        $(markers).each(function (index, data) {
          
          const pinSvgString =
            '<svg width="20" height="20" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21.3284 0V400.105L255.985 512L490.672 400.105V0H21.3284Z" fill="#F6B71A"/><path d="M223.293 286.541C225.822 286.511 228.23 286.42 230.639 286.42C247.527 286.42 264.385 286.42 281.273 286.42C299.425 286.42 317.608 286.45 335.76 286.481C338.68 286.481 341.6 286.481 344.52 285.969C346.658 285.577 348.735 285.036 350.691 284.193C358.247 280.911 362.281 275.011 363.214 266.913C363.485 264.625 363.576 262.277 363.576 259.959C363.576 254.541 363.816 249.122 363.305 243.703C363.154 242.078 362.913 240.452 362.492 238.887C360.475 231.421 355.508 226.815 348.313 224.467C345.333 223.504 342.262 223.203 339.162 223.022C337.867 222.962 336.573 222.932 335.278 222.932C282.417 222.932 229.555 222.932 176.693 222.932C173.081 222.932 169.468 223.083 165.916 223.895C164.742 224.166 163.568 224.497 162.454 224.919C154.326 227.959 149.871 233.89 148.787 242.409C148.577 244.035 148.456 245.66 148.426 247.286C148.306 251.079 148.215 254.842 148.215 258.635C148.215 282.236 148.215 305.807 148.215 329.408C148.215 330.432 148.215 331.455 148.215 332.629C147.523 332.719 146.951 332.9 146.379 332.9C142.947 332.9 139.485 332.9 136.054 332.9C122.868 332.9 109.713 332.9 96.5277 332.9C95.5945 332.9 94.6613 332.84 93.6679 332.81C93.3668 331.666 93.4572 330.642 93.4572 329.649C93.427 314.055 93.397 298.492 93.3668 282.898C93.3668 272.994 93.3066 263.09 93.3668 253.186C93.4271 241.355 95.5343 229.916 100.351 219.049C103.301 212.396 107.094 206.285 112.121 200.957C112.362 200.716 112.573 200.445 112.784 200.174C112.844 200.114 112.844 200.023 112.934 199.843C112.723 199.542 112.513 199.18 112.242 198.879C104.234 190.3 99.2671 180.125 96.2568 168.896C93.8485 159.925 93.1561 150.774 93.397 141.532C93.6077 133.224 94.7817 125.066 97.2201 117.118C100.14 107.636 104.535 98.9358 110.917 91.2896C120.069 80.2717 131.749 73.1974 145.506 69.5247C152.279 67.7185 159.173 66.8154 166.187 66.8756C167.391 66.8756 168.595 66.8756 169.8 66.8756C205.442 66.8756 241.085 66.8455 276.727 66.8154C299.967 66.8154 323.207 66.8154 346.477 66.8756C356.923 66.8756 366.977 68.8324 376.61 72.9866C389.404 78.4956 399.459 87.2557 406.774 99.0864C412.404 108.208 415.835 118.142 417.551 128.708C418.876 136.926 419.086 145.175 418.454 153.423C417.581 164.712 414.782 175.459 409.393 185.483C406.955 190.059 403.975 194.274 400.573 198.187C400.121 198.699 399.73 199.241 399.278 199.813C399.519 200.174 399.7 200.475 399.941 200.716C408.309 210.018 413.578 220.915 416.407 233.017C418.876 243.583 419.267 254.3 418.274 265.077C417.401 274.499 415.113 283.771 411.199 292.411C404.998 305.988 395.636 316.704 382.451 323.929C374.834 328.114 366.706 330.733 358.097 331.967C353.581 332.629 349.036 332.93 344.46 332.93C324.923 332.93 305.386 332.93 285.818 332.93C265.92 332.93 246.052 332.93 226.153 332.93C225.22 332.93 224.287 332.93 223.233 332.9C223.143 332.057 223.053 331.395 223.023 330.733C222.691 314.537 222.872 289.13 223.354 286.631L223.293 286.541ZM256.016 176.723C281.935 176.723 307.824 176.723 333.743 176.723C336.332 176.723 338.891 176.573 341.48 176.513C343.828 176.452 346.116 176.001 348.313 175.278C355.538 172.96 360.505 168.385 362.552 160.919C362.974 159.354 363.214 157.728 363.365 156.102C363.907 149.931 363.606 143.73 363.606 137.529C363.606 135.993 363.485 134.428 363.305 132.893C362.281 124.373 357.946 118.353 349.879 115.192C347.049 114.078 344.099 113.476 341.088 113.386C339.102 113.325 337.145 113.265 335.158 113.265C317.156 113.265 299.184 113.355 281.182 113.355C263.03 113.355 244.848 113.265 226.695 113.265C209.837 113.265 192.949 113.265 176.091 113.265C174.375 113.265 172.659 113.265 170.944 113.386C166.849 113.626 162.966 114.59 159.354 116.576C154.688 119.135 151.467 122.928 149.961 128.046C149.45 129.762 149.028 131.568 148.878 133.344C148.306 140.719 148.396 148.125 148.757 155.53C148.787 156.223 148.848 156.915 148.938 157.577C150.022 165.314 153.905 171.034 161.13 174.255C162.846 175.007 164.682 175.519 166.518 175.941C169.89 176.753 173.352 176.723 176.784 176.723C203.214 176.723 229.645 176.723 256.046 176.723H256.016Z" fill="white"/></svg>';
          const pinSvg = parser.parseFromString(pinSvgString, "image/svg+xml").documentElement;

          const marker = new AdvancedMarkerElement({
            position: data.position,            
            gmpClickable: true,
          });

          const infowindow = new google.maps.InfoWindow({
            ariaLabel: data.title,            
            content: "<div style='color: #000'>" + data.title + "</div>",
            title: "Banana"
          });

          marker.addListener("click", () => {            
            infowindow.open({
              anchor: marker,
              map,
            });
          });

          marker.append(pinSvg);
          marker.setMap(map);
        });
      }

      initMap();
    }
  });
})(jQuery);
